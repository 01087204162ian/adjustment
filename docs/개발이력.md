# 개발 이력

## 2025-12-26

### 초기 개발

#### 1. CLI 스크립트 개발 (`settle_baemin.py`)
- 배민 배달 운행 데이터 처리 스크립트 작성
- 주요 기능:
  - Excel 파일 읽기/쓰기
  - 운행 시간 형식 변환
  - 중복 시간 처리 (구간 병합)
  - 보험료 계산 (담보별 요율 적용)
  - 일별 집계 생성

#### 2. Streamlit 웹 앱 개발 (`app.py`)
- 웹 인터페이스 제공
- 주요 기능:
  - 파일 업로드
  - 실시간 처리 결과 표시
  - 결과 다운로드
  - 통계 정보 표시

#### 3. 출력 검증 스크립트 (`verify_output.py`)
- 출력 파일 구조 검증
- Windows 인코딩 문제 해결

#### 4. 문서화
- `README.md`: 프로젝트 개요 및 사용법
- `사용법.md`: 상세 사용 가이드
- `개발이력.md`: 개발 이력 기록
- `checklist.md`: 요구사항 체크리스트

#### 5. 프로젝트 설정
- `requirements.txt`: 패키지 의존성 정의
- `.gitignore`: Git 무시 파일 목록 (데이터 파일, Excel 파일 제외)

### 주요 구현 사항

#### 시간 처리
- 시작시간/종료시간을 `YYYY-MM-DD HH:MM:SS` 형식으로 변환
- 전체 운행시간 계산 (종료시간 - 시작시간)
- 보험사 기준영업일 계산 (시작시간의 날짜)

#### 중복 시간 처리
- 이전 종료시간과 다음 시작시간 비교
- 중복 구간 병합 알고리즘 구현
- 중복 시간 계산 및 차감

#### 보험료 계산
- 담보별 요율 적용:
  - 대인1지원: 3.28
  - 대인2: 4.34
  - 대물: 3.68
- 원단위 절사 처리
- 담보별 보험료 합산

#### 오류 처리
- 입력 파일 존재 확인
- 필수 컬럼 검증
- Excel 파일 형식 검증
- 다운로드 중인 파일(.crdownload) 감지
- 빈 파일 처리

#### 성능 최적화
- 벡터화 연산 사용 (`np.where`, `map`)
- `df.apply()` 대신 벡터화된 연산으로 변경
- 대용량 파일 처리 최적화

### 해결한 문제

1. **패키지 의존성 충돌**
   - `numpy` 버전을 `1.21.0` 이상 `1.22.0` 미만으로 제한
   - `scipy`, `numba`와의 호환성 확보

2. **Windows 인코딩 문제**
   - 콘솔 출력 시 UTF-8 인코딩 설정
   - `io.TextIOWrapper` 사용

3. **Excel 파일 읽기 오류**
   - `.crdownload` 파일 감지 및 오류 메시지 제공
   - 손상된 파일 감지 및 처리

### 향후 개선 사항

1. **보험료 계산 로직 검토**
   - 현재: 중복 차감 전 시간 사용
   - 검토 필요: 중복 차감 후 시간 사용 여부

2. **성능 개선**
   - 대용량 파일 처리 최적화
   - 병렬 처리 고려

3. **기능 추가**
   - 여러 파일 일괄 처리
   - 커스텀 요율 설정 UI
   - 처리 이력 저장

4. **테스트**
   - 단위 테스트 작성
   - 통합 테스트 작성
   - 엣지 케이스 테스트

### 기술 스택

- **언어**: Python 3.x
- **주요 라이브러리**:
  - `pandas`: 데이터 처리
  - `openpyxl`: Excel 파일 처리
  - `numpy`: 수치 연산
  - `streamlit`: 웹 인터페이스

### 참고 사항

- 모든 요구사항은 `checklist.md`에 기록되어 있습니다
- 패키지 의존성은 `requirements.txt`에 정의되어 있습니다
- 데이터 파일은 `.gitignore`에 의해 Git에서 제외됩니다

