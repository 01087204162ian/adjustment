# 사용법 가이드

## 1. CLI 스크립트 사용법

### 기본 사용법

```bash
python settle_baemin.py <입력파일> <출력파일>
```

### 예시

```bash
# Windows PowerShell
python settle_baemin.py driving_data_20251101_20251130.xlsx 정산_결과.xlsx

# Linux/Mac
python3 settle_baemin.py driving_data_20251101_20251130.xlsx 정산_결과.xlsx
```

### 필수 입력 파일 형식

Excel 파일에 다음 컬럼이 포함되어 있어야 합니다:

- **기사이이디** (E열): 기사 식별자
- **시작시간** (G열): 운행 시작 시간
- **종료시간** (H열): 운행 종료 시간
- **담보** (담보 컬럼): 대인1지원, 대인2, 대물 중 하나
- **보험사 정산 상태 정보** (M열): '00'인 경우만 정산 대상

### 출력 파일

3개의 시트가 포함된 Excel 파일이 생성됩니다:

1. **01_상세_보험료**: 모든 운행 건별 상세 정보
2. **02_일자요약_보험료**: 기사별 일자별 집계
3. **03_병합구간(검증)**: 중복 구간 병합 결과

## 2. Streamlit 웹 앱 사용법

### 실행 방법

```bash
cd adjustment
streamlit run app.py
```

브라우저가 자동으로 열리며 `http://localhost:8501`에서 앱에 접근할 수 있습니다.

### 사용 단계

1. **파일 업로드**
   - 왼쪽 사이드바에서 "파일 업로드" 섹션을 찾습니다
   - "Browse files" 버튼을 클릭하여 Excel 파일을 선택합니다

2. **처리 실행**
   - 파일이 업로드되면 자동으로 처리됩니다
   - 처리 결과가 화면에 표시됩니다

3. **결과 확인**
   - **상세 데이터**: 모든 운행 건별 정보
   - **일자 요약**: 기사별 일자별 집계
   - **병합 구간**: 중복 구간 병합 결과
   - **통계**: 전체 통계 정보

4. **파일 다운로드**
   - "다운로드" 버튼을 클릭하여 결과 Excel 파일을 다운로드합니다

## 3. 출력 파일 검증

### 사용법

```bash
python verify_output.py <출력파일.xlsx>
```

### 검증 항목

- 시트 존재 여부 확인
- 각 시트의 컬럼 구조 확인
- 데이터 행 수 확인
- 기본 통계 정보 출력

## 4. 오류 처리

### 일반적인 오류

#### 1. 파일을 찾을 수 없음
```
FileNotFoundError: 입력 파일을 찾을 수 없습니다: <파일명>
```
**해결**: 파일 경로를 확인하고 파일이 존재하는지 확인하세요.

#### 2. 다운로드 중인 파일
```
ValueError: 다운로드 중인 파일입니다: <파일명>.crdownload
```
**해결**: Chrome에서 다운로드가 완료될 때까지 기다린 후, .xlsx 확장자로 변경된 파일을 사용하세요.

#### 3. 엑셀 파일 형식 오류
```
ValueError: 엑셀 파일 형식이 올바르지 않습니다
```
**해결**: 파일이 손상되었거나 다운로드가 완료되지 않았을 수 있습니다. 파일을 다시 다운로드하세요.

#### 4. 필수 컬럼 누락
```
ValueError: 필수 컬럼이 누락되었습니다: <컬럼명>
```
**해결**: 입력 파일에 필수 컬럼이 포함되어 있는지 확인하세요.

#### 5. 빈 파일
```
ValueError: 입력 파일이 비어있습니다.
```
**해결**: 입력 파일에 데이터가 포함되어 있는지 확인하세요.

## 5. 성능 최적화

### 대용량 파일 처리

- 대용량 파일의 경우 처리 시간이 오래 걸릴 수 있습니다
- Streamlit 앱에서는 진행 상황이 표시됩니다
- CLI 스크립트는 처리 완료 시까지 대기합니다

### 메모리 사용량

- 대용량 파일 처리 시 메모리 사용량이 증가할 수 있습니다
- 필요시 파일을 분할하여 처리하세요

## 6. 고급 사용법

### 배치 처리

여러 파일을 처리하려면 스크립트를 작성하세요:

```python
import os
from pathlib import Path
from settle_baemin import process

input_dir = Path("input")
output_dir = Path("output")
output_dir.mkdir(exist_ok=True)

for input_file in input_dir.glob("*.xlsx"):
    output_file = output_dir / f"result_{input_file.name}"
    try:
        process(str(input_file), str(output_file))
        print(f"처리 완료: {input_file.name}")
    except Exception as e:
        print(f"오류 발생 ({input_file.name}): {e}")
```

### 커스텀 요율 적용

`settle_baemin.py`의 `RATES` 딕셔너리를 수정하여 요율을 변경할 수 있습니다:

```python
RATES = {
    "대인1지원": 3.28,  # 원하는 요율로 변경
    "대인2": 4.34,
    "대물": 3.68,
}
```

## 7. FAQ

### Q: 출력 파일의 보험료가 0으로 나오는 경우는?
A: 상태정보가 '00'이 아닌 경우 또는 운행시간이 0인 경우입니다.

### Q: 중복 시간이 제대로 차감되지 않는 경우는?
A: 시작시간과 종료시간의 형식이 올바른지 확인하세요.

### Q: Streamlit 앱이 실행되지 않는 경우는?
A: `streamlit` 패키지가 설치되어 있는지 확인하세요:
```bash
pip install streamlit
```

### Q: 한글이 깨지는 경우는?
A: Windows에서는 콘솔 인코딩을 UTF-8로 설정해야 합니다. `verify_output.py`는 자동으로 처리합니다.

