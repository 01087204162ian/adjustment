# 사륜 운행 데이터 → DB 정산 결과 변환 시스템

## 프로젝트 개요

플랫폼 운행 원천 데이터(분 단위)를 기준으로 담보별 운행시간을 집계하고, 보험료를 산출하며, 중복·자차 여부를 분리 계산하여 DB 정산 기준 결과 엑셀을 생성하는 시스템입니다.

## 주요 기능

1. **운행 시간 처리**
   - 시작시간/종료시간 형식 변환
   - 운행 시간(분) 계산 (초 단위 절사)

2. **영업일 계산**
   - 배민 기준 영업일: 06:00 ~ D+1 06:00
   - DB 기준 영업일: 00:00 ~ 24:00

3. **자차 포함/미포함 분리**
   - 운행(분)_자차포함
   - 운행(분)_자차미포함

4. **중복 운행 시간 계산**
   - 중복운행(분)_자차포함
   - 중복운행(분)_자차미포함

5. **보험료 계산**
   - 담보별 분당 보험료 적용
   - 원단위 절사 후 합산

6. **DB 정산 포맷 출력**
   - 정산·회계 기준 구조
   - 모든 필수 컬럼 포함

## 파일 구조

```
adjustment/
├── settle_saryun.py          # 메인 처리 스크립트
├── requirements.txt          # Python 패키지 의존성
├── README.md                # 이 파일
└── docs/                    # 문서 폴더
    └── 사륜_정산_시나리오.md  # 상세 시나리오 문서
```

## 사용법

### CLI 스크립트 사용

```bash
python settle_saryun.py <입력파일.xlsx> --out <출력파일.xlsx>
```

**예시:**
```bash
python settle_saryun.py driving_data_20251101_20251130.xlsx --out DB_사륜_251031_251130.xlsx
```

## 입력 파일 형식

**필수 컬럼:**
- 보험사 운행 ID
- 플랫폼 운행 ID
- 기사아이디
- 시작시간 / 종료시간
- 담보
- 보험사기준영업일
- 배민기준영업일
- 보험사 정산 상태 정보

## 출력 파일 형식

**주요 컬럼:**
- 보험사 운행 ID
- 플랫폼 운행 ID
- 시작시간 / 종료시간
- 운행시간
- 담보
- 운행수
- 보험료
- 상태
- 배민기준 / DB기준
- 운행일
- 운행(분)_자차포함 / 자차미포함
- 중복운행(분)_자차포함 / 자차미포함

## 담보별 분당 보험료

| 담보 | 요율 (원/분) |
|------|-------------|
| 대인1 / 대인1지원 | 3.28 |
| 대인2 | 4.34 |
| 대물 | 3.68 |
| 자차 | 0.0 (보험료 없음) |

## 의존성

필수 패키지:
- `pandas>=1.5.0,<2.0.0`
- `openpyxl>=3.1.0`
- `numpy>=1.21.0,<1.22.0`

설치 방법:
```bash
pip install -r requirements.txt
```

## 상세 문서

자세한 시나리오 및 처리 흐름은 [`docs/사륜_정산_시나리오.md`](docs/사륜_정산_시나리오.md)를 참조하세요.

## 주의사항

1. **보험료 계산 순서**: 담보별로 원단위 절사 후 합산 (중요!)
2. **자차 처리**: 자차는 보험료가 0원이지만 운행시간은 포함
3. **중복 시간**: 자차 포함/미포함을 별도로 계산
4. **영업일 기준**: 배민 기준(06:00~D+1 06:00)과 DB 기준(00:00~24:00) 구분

## 라이선스

내부 사용 목적으로 개발되었습니다.

